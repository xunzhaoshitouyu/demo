<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>表格排序</title>
    <style type="text/css">
        #tab1 {
            position: absolute;
            top: 100px;
            left: 400px;
            border-collapse: collapse;
        }
        
        input {
            border: 1px solid #ccc;
        }
        
        td {
            text-align: center;
        }
    </style>
</head>

<body>
    <table id="tab1" border="1" width="600">
        <thead id="thead">
            <td>姓名</td>
            <td>学号</td>
            <td>语文</td>
            <td>英语</td>
            <td>数学</td>
            <td>综合</td>
            <td>名次</td>
        </thead>
        <tbody>
            <tr>
                <td>松松</td>
                <td>7799</td>
                <td>56</td>
                <td>78</td>
                <td>85</td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>兔兔</td>
                <td>7791</td>
                <td>36</td>
                <td>86</td>
                <td>85</td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>婷婷</td>
                <td>7794</td>
                <td>65</td>
                <td>73</td>
                <td>98</td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>源源</td>
                <td>7779</td>
                <td>51</td>
                <td>91</td>
                <td>88</td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>吵吵</td>
                <td>7772</td>
                <td>18</td>
                <td>59</td>
                <td>72</td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>亮亮</td>
                <td>7788</td>
                <td>63</td>
                <td>80</td>
                <td>86</td>
                <td></td>
                <td></td>
            </tr>
        </tbody>
    </table>
    <div>
        <h3>查询</h3> 姓名:
        <input id="inp" type='text' />
        <button id="btn1">搜索</button>
    </div>
    <div>
        <h3>插入</h3>姓名:
        <input type="text">
        <button id="btn1">插入</button>
    </div>
    <div>
        <h3>删除</h3>删除：
        <button id="delete">删除</button>
    </div>
    <script type="text/javascript">
        window.onload = function() {
            var oTab = document.getElementById('tab1');
            var oTheadTd = document.getElementsByTagName('thead')[0].getElementsByTagName('td');
            var oTbodyTr = document.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            var btn1 = document.getElementsByTagName('button')[0];
            var inp = document.getElementById('inp');
            var thead = document.getElementById('thead');
            var del = document.getElementById('delete');
            var tbd = document.getElementsByTagName('tbody')[0];
            var i = 0;
            var grade = [];

            //查询按钮点击事件
            btn1.onclick = function() {
                console.log(oTab);
                // console.log(1);
                for (i = 0; i < oTab.tBodies[0].rows.length; i++) {
                    var str1 = oTab.tBodies[0].rows[i].cells[0].innerHTML;
                    var str2 = inp.value;
                    if (str1 == str2) {
                        oTab.tBodies[0].rows[i].style.background = 'red';
                    } else {
                        oTab.tBodies[0].rows[i].style.background = '';
                    }

                    if (str1.search(str2) != -1) {
                        oTab.tBodies[0].rows[i].style.background = 'red';
                    } else {
                        oTab.tBodies[0].rows[i].style.background = '';
                    }
                    var arr = str2.split(' ');
                    // console.log(arr);
                    for (j = 0; j < arr.length; j++) {
                        if (str1.search(arr[j]) != -1) {
                            oTab.tBodies[0].rows[i].style.background = 'red';
                        }
                    }

                }

            }

            //删除按钮点击事件
            del.onclick = function() {
                if (oTbodyTr.length - 1 >= 0) {
                    tbd.removeChild(oTbodyTr[oTbodyTr.length - 1]);
                }
            }

            for (i = 0; i < oTab.tBodies[0].rows.length; i++) {

                for (var j = 0; j < oTab.tBodies[0].rows[0].cells.length; j++) {

                    grade[i] = oTab.tBodies[0].rows[i].cells[5].innerHTML = parseInt(oTab.tBodies[0].rows[i].cells[2].innerHTML) +
                        parseInt(oTab.tBodies[0].rows[i].cells[3].innerHTML) + parseInt(oTab.tBodies[0].rows[i].cells[4].innerHTML);
                }
            }
            var t = oTab.tBodies[0].rows.length;
            for (i = 0; i < oTab.tBodies[0].rows.length; i++) {
                for (var j = 0; j < oTab.tBodies[0].rows.length; j++) {

                    if (grade[i] > grade[j]) {
                        t--;
                    }
                    if (j == oTab.tBodies[0].rows.length - 1) {
                        oTab.tBodies[0].rows[i].cells[6].innerHTML = t;
                        t = oTab.tBodies[0].rows.length;
                    }
                }

            }

            //事件委托
            var iColor = '';
            for (i = 0; i < oTheadTd.length; i++) {
                oTheadTd[i].index = i;
                oTheadTd[i].style.cursor = " pointer";
                oTheadTd[i].flag = true;
                oTheadTd[i].style.background = "#ccc";
                thead.onclick = function(ev) {
                    var even = ev || window.event;
                    var tar = even.target || even.srcElement;
                    var arr = [];
                    // 转换为数组
                    var n = tar.index;
                    // 将变量的下标传给n 函数调用;
                    for (var j = 0; j < oTab.tBodies[0].rows.length; j++) {
                        arr[j] = oTab.tBodies[0].rows[j];
                    }
                    // 数组排序
                    arr.sort(function(tr1, tr2) {
                        if (oTheadTd[n].flag) {
                            return parseInt(tr1.cells[n].innerHTML) - parseInt(tr2.cells[n].innerHTML);
                        } else {
                            return parseInt(tr2.cells[n].innerHTML) - parseInt(tr1.cells[n].innerHTML);
                        }
                    });
                    // 重新插入
                    for (var j = 0; j < arr.length; j++) {
                        oTab.tBodies[0].appendChild(arr[j]);
                    }

                    oTheadTd[n].flag = !oTheadTd[n].flag;
                }
                thead.onmouseover = function(ev) {
                    var even = ev || window.event;
                    var tar = even.target || even.srcElement;
                    iColor = tar.style.background;
                    tar.style.background = 'red';
                }
                thead.onmouseout = function(ev) {
                    var even = ev || window.event;
                    var tar = even.target || even.srcElement;
                    tar.style.background = iColor;
                }
            }
        }
    </script>
</body>

</html>